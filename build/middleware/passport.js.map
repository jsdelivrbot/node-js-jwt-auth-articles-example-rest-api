{"version":3,"sources":["../../src/middleware/passport.js"],"names":["passport","opts","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","secretOrKey","CONFIG","jwt_encryption","use","Strategy","jwt_payload","done","err","user","User","findById","user_id"],"mappings":";;;;;;;;kBAKe,UAASA,QAAT,EAAkB;AAC7B,QAAIC,OAAO,EAAX;AACAA,SAAKC,cAAL,GAAsBC,wBAAWC,2BAAX,EAAtB;AACAH,SAAKI,WAAL,GAAmBC,iBAAOC,cAA1B;;AAEAP,aAASQ,GAAT,CAAa,IAAIC,qBAAJ,CAAaR,IAAb;AAAA,2EAAmB,iBAAeS,WAAf,EAA4BC,IAA5B;AAAA;;AAAA;AAAA;AAAA;AAAA;AACxBC,+BADwB,WACnBC,IADmB;AAAA;AAAA,mCAER,cAAGC,eAAKC,QAAL,CAAcL,YAAYM,OAA1B,CAAH,CAFQ;;AAAA;AAAA;AAAA;AAE3BJ,+BAF2B;AAEtBC,gCAFsB;;AAAA,iCAGzBD,GAHyB;AAAA;AAAA;AAAA;;AAAA,6DAGbD,KAAKC,GAAL,EAAU,KAAV,CAHa;;AAAA;AAAA,iCAIzBC,IAJyB;AAAA;AAAA;AAAA;;AAAA,6DAKjBF,KAAK,IAAL,EAAWE,IAAX,CALiB;;AAAA;AAAA,6DAOjBF,KAAK,IAAL,EAAW,KAAX,CAPiB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAnB;;AAAA;AAAA;AAAA;AAAA,QAAb;AAUH,C;;AApBD;;AACA;;;;AACA;;;;AACA;;;;;;AAiBC","file":"passport.js","sourcesContent":["import { ExtractJwt, Strategy } from 'passport-jwt';\nimport User from './../models/User';\nimport CONFIG from './../config/config';\nimport { to } from './../services/util.service';\n\nexport default function(passport){\n    let opts = {};\n    opts.jwtFromRequest = ExtractJwt.fromAuthHeaderAsBearerToken();\n    opts.secretOrKey = CONFIG.jwt_encryption;\n\n    passport.use(new Strategy(opts, async function(jwt_payload, done){\n        let err, user;\n        [err, user] = await to(User.findById(jwt_payload.user_id));\n        if(err) return done(err, false);\n        if(user) {\n            return done(null, user);\n        }else{\n            return done(null, false);\n        }\n    }));\n};\n"]}